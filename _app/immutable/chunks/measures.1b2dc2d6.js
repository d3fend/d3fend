import{w as L}from"./index.227a97d3.js";import{e as m}from"./consts.3b726b9b.js";var C={local:{},session:{}};function P(r){return r==="local"?localStorage:sessionStorage}function T(r,g,l){var f,v;const h=(f=l==null?void 0:l.serializer)!=null?f:JSON,d=(v=l==null?void 0:l.storage)!=null?v:"local",b=typeof window<"u"&&typeof document<"u",u=b?P(d):null;function q(a,p){u==null||u.setItem(a,h.stringify(p))}if(!C[d][r]){const a=L(g,s=>{const o=u==null?void 0:u.getItem(r);if(o&&s(h.parse(o)),b&&d=="local"){const e=t=>{t.key===r&&s(t.newValue?h.parse(t.newValue):null)};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}}),{subscribe:p,set:M}=a;C[d][r]={set(s){q(r,s),M(s)},update(s){return a.update(o=>{const e=s(o);return q(r,e),e})},subscribe:p}}return C[d][r]}const I=r=>{const{subscribe:g,update:l,set:f}=T("d3fend-measures",r);return{subscribe:g,update:l,set:f,createPortfolio:s=>l(o=>{const e=o.portfolios.length;return s.id=e,s.includedMeasures=[],o.portfolios.push(s),o.selectedPortfolio=e,o}),deletePortfolio:()=>l(s=>(s.portfolios=s.portfolios.filter((o,e)=>e!==s.selectedPortfolio),s.selectedPortfolio=s.portfolios.length?0:null,s)),addMeasure:s=>l(o=>{var t;const e=s.name.toLowerCase();return s.id=((t=Object.values(o.measures))==null?void 0:t.length)+1,s.techniques=[],s.checked=!1,s.color="#0075FF",o.measures[e]=s,o.portfolios[o.selectedPortfolio].includedMeasures.push(e),o}),addChild:(s,o)=>l(e=>{var i;const t=((i=Object.values(e.measures))==null?void 0:i.length)||0,c=o.name.toLowerCase(),n=s.name.toLowerCase();return o.id=t+1,o.checked=!0,o.techniques=[...s.techniques],e.measures[c]=o,e.measures[n].children||(e.measures[n].children=[]),e.measures[n].children.push(c),e.measures[n].techniques=[],e}),deleteMeasure:s=>l(o=>{const e=o.selectedPortfolio;return o.portfolios=o.portfolios.reduce((t,c,n)=>{if(e===n){const i={...c};i.includedMeasures=i.includedMeasures.filter(w=>w!==s.name.toLowerCase()),t.push(i)}else t.push({...c});return t},[]),o}),deleteSubmeasure:(s,o)=>l(e=>{const t=s.name.toLowerCase();return e.measures[t].children=e.measures[t].children.filter(c=>c!==o.name.toLowerCase()),e}),saveTechniques:(s,o)=>l(e=>{const t=Object.values(s).reduce((n,i)=>(i.classes.isSelected&&n.push(i["@id"]),n),[]);return Object.entries(o).reduce((n,[i,w])=>(w&&n.push(i),n),[]).forEach(n=>{const i=[...new Set([...e.measures[n].techniques,...t])];e.measures[n].techniques=i,e.measures[n].checked=!0}),e}),saveMeasureColor:(s,o)=>l(e=>(e.measures[s.name.toLowerCase()].color=o,e)),changeTechniqueMappingMode:(s,o)=>l(e=>(e.techniqueMappingMode=s,e.showLegend=o,e))}},K=I(m);export{K as m};
