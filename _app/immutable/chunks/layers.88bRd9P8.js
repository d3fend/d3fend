import{w as j}from"./index.WEqpRfbK.js";import{c as R}from"./_createCompounder.oCNsAIha.js";import{P as p,S as M,f as _}from"./consts.xgbGpGkg.js";var I={local:{},session:{}};function A(c){return c==="local"?localStorage:sessionStorage}function D(c,a,t){var u,b;const v=(u=t?.serializer)!=null?u:JSON,x=(b=t?.storage)!=null?b:"local",P=typeof window<"u"&&typeof document<"u",m=P?A(x):null;function C(T,q){m?.setItem(T,v.stringify(q))}if(!I[x][c]){const T=j(a,f=>{const g=m?.getItem(c);if(g&&f(v.parse(g)),P&&x=="local"){const y=S=>{S.key===c&&f(S.newValue?v.parse(S.newValue):null)};return window.addEventListener("storage",y),()=>window.removeEventListener("storage",y)}}),{subscribe:q,set:E}=T;I[x][c]={set(f){C(c,f),E(f)},update(f){return T.update(g=>{const y=f(g);return C(c,y),y})},subscribe:q}}return I[x][c]}var U=R(function(c,a,t){return c+(t?"-":"")+a.toLowerCase()});const k=()=>{let c=new Date().getTime(),a=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let u=Math.random()*16;return c>0?(u=(c+u)%16|0,c=Math.floor(c/16)):(u=(a+u)%16|0,a=Math.floor(a/16)),(t=="x"?u:u&7|8).toString(16)})};function L(c){return`${U(c)}-${k().split("-").slice(0,2).join("")}`}function H(c,a){return c.map(t=>(t.children=t.children.map(u=>a[u]),t))}const F=c=>{const{subscribe:a,update:t,set:u}=D("d3fend-layers",_);return{subscribe:a,update:t,set:u,createProfile:n=>t(e=>{const r=e.profiles.length;return n.id=r,n.includedLayers=[],e.profiles.push(n),e.selectedProfile=r,e}),deleteProfile:()=>t(n=>(n.profiles=n.profiles.filter((e,r)=>r!==n.selectedProfile),n.selectedProfile=n.profiles.length?0:null,n)),addLayer:n=>t(e=>(e.layers[n.id]=n,e.profiles[e.selectedProfile].includedLayers.push(n.id),e)),bulkAddLayer:(n,e)=>t(r=>{for(const l of n)r.layers[l.id]=l;return r.profiles[r.selectedProfile].includedLayers.push(e),r}),addTemplate:n=>t(e=>(e.templates[n.id]=n,e.rootTemplates.push(n.id),e)),copyFromTemplate:(n,e=p.layers)=>t(r=>(n.id=L(n.name),r[e][n.id]=n,r)),appendLayer:n=>t(e=>(e.layers[n]&&e.profiles[e.selectedProfile].includedLayers.push(n),e)),editName:(n,e,r=p.layers)=>t(l=>(l[r][n].name=e,l)),editDescription:(n,e,r=p.layers)=>t(l=>(l[r][n].description=e,l)),addChild:(n,e,r,l=p.layers)=>t(i=>{const o=L(e.name),d=n.id;return e.id=o,e.checked=!0,e.children=[],e.techniques=[...n.techniques],e.color=n.color,i[l][o]=e,i[l][d].children||(i[l][d].children=[]),i[l][d].children.push(o),i[l][d].techniques=[],i}),addNonRootChild:(n,e,r=p.layers)=>t(l=>{const i=L(e.name);return e.id=i,e.checked=!0,e.techniques=[],e.children=[],e.color=n.color,l[r][i]=e,l[r][n.id].children.push(i),l}),deleteLayer:n=>t(e=>{const{[n]:r,...l}=e.layers,i=e.profiles.reduce((o,d,s)=>{if(e.selectedProfile===s){const h={...d,includedLayers:d.includedLayers.filter(O=>O!==n)};o.push(h)}else o.push(d);return o},[]);return{...e,profiles:i,layers:l}}),deleteTemplate:n=>t(e=>{const{[n]:r,...l}=e.templates,i=e.rootTemplates.filter(o=>n!==o);return{...e,templates:l,rootTemplates:i}}),deleteSublayer:(n,e,r=p.layers)=>t(l=>{const i=e.id;return l[r][i].children=l[r][i].children.filter(o=>o!==n.id),delete l[r][n.id],l}),saveTechniques:(n,e,r=p.layers)=>t(l=>{const i=Object.values(n).reduce((d,s)=>(s.classes.isSelected&&d.push(s["@id"]),d),[]);return Object.entries(e).reduce((d,[s,h])=>(h===M.selected&&d.push(s),d),[]).forEach(d=>{const s=[...new Set([...l[r][d].techniques,...i])];l[r][d].techniques=s,l[r][d].checked=!0}),l}),removeTechniques:(n,e,r=p.layers)=>t(l=>{const i=Object.values(n).reduce((d,s)=>(s.classes.isSelected&&d.push(s["@id"]),d),[]);return Object.entries(e).reduce((d,[s,h])=>(h===M.selected&&d.push(s),d),[]).forEach(d=>{const s=l[r][d].techniques.filter(h=>!i.includes(h));l[r][d].techniques=s,l[r][d].checked=!0}),l}),saveLayerColor:(n,e,r=p.layers)=>t(l=>(l[r][n.id].color=e,l)),changeTechniqueMappingMode:(n,e)=>t(r=>(r.techniqueMappingMode=n,r.showLegend=e,r))}},Q=F();export{L as c,Q as l,H as m};
